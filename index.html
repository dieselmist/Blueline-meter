<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Blueline Meter</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
:root {
  --blue: #00d4ff;
  --blue2: #0099cc;
  --blue-glow: rgba(0,212,255,0.3);
  --bg: #05080d;
  --panel: #080d14;
  --surface: #0c1420;
  --surface2: #101825;
  --border: rgba(0,212,255,0.1);
  --border2: rgba(255,255,255,0.05);
  --text: #e0f4ff;
  --muted: #2a4060;
  --muted2: #4a6080;
  --green: #00ff88;
  --red: #ff3355;
  --amber: #ffaa00;
}
* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
html, body { width: 100%; height: 100%; overflow: hidden; background: var(--bg); font-family: 'Rajdhani', sans-serif; color: var(--text); }

/* ‚îÄ‚îÄ PIN SCREEN ‚îÄ‚îÄ */
.pin-screen {
  position: fixed; inset: 0; z-index: 9999;
  background: var(--bg);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  background-image: radial-gradient(ellipse at 50% 30%, rgba(0,212,255,0.07) 0%, transparent 60%);
}
.pin-screen.hidden { display: none; }
.pin-logo {
  width: 64px; height: 64px; border-radius: 16px;
  background: linear-gradient(135deg, #00d4ff, #0077aa);
  display: flex; align-items: center; justify-content: center;
  font-size: 32px; margin-bottom: 18px;
  box-shadow: 0 0 36px rgba(0,212,255,0.45);
}
.pin-title { font-family: 'Orbitron', monospace; font-size: 22px; font-weight: 700; letter-spacing: 5px; color: var(--blue); margin-bottom: 4px; }
.pin-sub { font-size: 10px; letter-spacing: 4px; color: var(--muted2); margin-bottom: 36px; }
.pin-dots { display: flex; gap: 18px; margin-bottom: 34px; }
.pin-dot { width: 16px; height: 16px; border-radius: 50%; border: 2px solid rgba(0,212,255,0.25); background: transparent; transition: all 0.2s; }
.pin-dot.filled { background: var(--blue); border-color: var(--blue); box-shadow: 0 0 12px var(--blue); }
.pin-dot.error { background: var(--red); border-color: var(--red); box-shadow: 0 0 12px var(--red); }
.pin-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; width: 288px; }
.pin-btn {
  height: 76px; border-radius: 14px;
  background: var(--surface); border: 1px solid var(--border2);
  color: var(--text); font-family: 'Orbitron', monospace;
  font-size: 22px; font-weight: 700; cursor: pointer;
  -webkit-appearance: none; transition: all 0.15s;
  box-shadow: 0 4px 14px rgba(0,0,0,0.4);
}
.pin-btn:active { background: rgba(0,212,255,0.12); border-color: var(--blue); color: var(--blue); transform: scale(0.95); }
.pin-btn.del { font-size: 20px; color: var(--muted2); }
.pin-btn.empty { visibility: hidden; }
.pin-error { font-size: 11px; letter-spacing: 3px; color: var(--red); margin-top: 22px; min-height: 16px; text-align: center; }

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.container { display: flex; width: 100vw; height: 100vh; }

/* ‚îÄ‚îÄ METER PANEL ‚îÄ‚îÄ */
.meter {
  width: 420px; min-width: 420px; height: 100%;
  background: var(--panel); border-right: 1px solid var(--border);
  display: flex; flex-direction: column; position: relative; overflow: hidden;
  box-shadow: 4px 0 40px rgba(0,0,0,0.8);
}
.meter::before {
  content: ''; position: absolute; inset: 0;
  background-image: linear-gradient(rgba(0,212,255,0.015) 1px, transparent 1px), linear-gradient(90deg, rgba(0,212,255,0.015) 1px, transparent 1px);
  background-size: 40px 40px; pointer-events: none;
}
.meter-inner { position: relative; z-index: 1; display: flex; flex-direction: column; height: 100%; padding: 16px 16px 14px; }

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; }
.brand { display: flex; align-items: center; gap: 10px; }
.brand-logo {
  width: 38px; height: 38px; border-radius: 8px;
  background: linear-gradient(135deg, var(--blue), var(--blue2));
  display: flex; align-items: center; justify-content: center; font-size: 18px;
  box-shadow: 0 0 16px var(--blue-glow), inset 0 1px 0 rgba(255,255,255,0.2);
}
.brand-name { font-family: 'Orbitron', monospace; font-size: 13px; font-weight: 700; letter-spacing: 3px; color: var(--blue); }
.brand-sub { font-size: 9px; letter-spacing: 3px; color: var(--muted2); margin-top: 1px; }
.status-wrap { text-align: right; }
.status-pill {
  display: inline-block; padding: 5px 14px; border-radius: 4px;
  font-family: 'Orbitron', monospace; font-size: 11px; font-weight: 600; letter-spacing: 3px;
  background: rgba(42,64,96,0.4); border: 1px solid var(--muted); color: var(--muted2); transition: all 0.4s;
}
.status-pill.hired { background: rgba(0,255,136,0.1); border-color: var(--green); color: var(--green); box-shadow: 0 0 12px rgba(0,255,136,0.2); }
.status-pill.complete { background: rgba(255,170,0,0.1); border-color: var(--amber); color: var(--amber); }
.tariff-indicator { font-size: 9px; letter-spacing: 2px; color: var(--muted2); margin-top: 3px; }

/* ‚îÄ‚îÄ FARE ‚îÄ‚îÄ */
.fare-section {
  background: linear-gradient(160deg, #0a1520, #060d16);
  border: 1px solid var(--border); border-radius: 16px; padding: 18px 22px 16px;
  margin-bottom: 14px; position: relative; overflow: hidden;
  box-shadow: 0 0 30px rgba(0,0,0,0.5), inset 0 1px 0 rgba(0,212,255,0.1);
}
.fare-section::before {
  content: ''; position: absolute; top: 0; left: 20px; right: 20px; height: 1px;
  background: linear-gradient(90deg, transparent, var(--blue), transparent); opacity: 0.6;
}
.fare-section::after {
  content: ''; position: absolute; inset: 0;
  background: radial-gradient(ellipse at 50% 0%, rgba(0,212,255,0.04) 0%, transparent 70%); pointer-events: none;
}
.fare-top { display: flex; justify-content: space-between; margin-bottom: 6px; }
.fare-lbl { font-size: 9px; letter-spacing: 5px; color: var(--muted2); text-transform: uppercase; }
.fare-row { display: flex; align-items: flex-end; gap: 4px; }
.fare-currency { font-family: 'Orbitron', monospace; font-size: 14px; color: rgba(0,212,255,0.4); align-self: flex-start; margin-top: 10px; margin-right: -6px; }
.fare-amount {
  font-family: 'Orbitron', monospace; font-size: 80px; line-height: 1; font-weight: 900;
  color: var(--blue); letter-spacing: -2px;
  text-shadow: 0 0 30px rgba(0,212,255,0.6), 0 0 80px rgba(0,212,255,0.2);
  transition: text-shadow 0.2s;
}
.fare-amount.flash { text-shadow: 0 0 50px rgba(0,212,255,1), 0 0 100px rgba(0,212,255,0.5); }
.fare-breakdown { font-size: 11px; color: var(--muted2); margin-top: 6px; min-height: 14px; }

/* ‚îÄ‚îÄ STATS ‚îÄ‚îÄ */
.stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 12px; }
.stat {
  background: var(--surface); border: 1px solid var(--border2);
  border-radius: 10px; padding: 10px 8px; text-align: center; position: relative; overflow: hidden;
}
.stat::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px; background: linear-gradient(90deg, transparent, rgba(0,212,255,0.3), transparent); }
.stat-lbl { font-size: 8px; letter-spacing: 3px; color: var(--muted2); text-transform: uppercase; margin-bottom: 4px; }
.stat-val { font-family: 'Share Tech Mono', monospace; font-size: 15px; color: var(--text); }
.stat-val.active { color: var(--blue); }

/* ‚îÄ‚îÄ RINGS ‚îÄ‚îÄ */
.rings { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px; }
.ring-card { background: var(--surface); border: 1px solid var(--border2); border-radius: 10px; padding: 11px 10px; display: flex; align-items: center; gap: 10px; }
.ring-info .rl { font-size: 8px; letter-spacing: 3px; color: var(--muted2); text-transform: uppercase; }
.ring-info .rv { font-family: 'Share Tech Mono', monospace; font-size: 14px; color: var(--text); margin-top: 2px; }
.ring-info .rp { font-size: 10px; color: var(--muted2); margin-top: 1px; }
svg.ring { transform: rotate(-90deg); flex-shrink: 0; }
circle.rb { fill: none; stroke: rgba(0,212,255,0.06); stroke-width: 5; }
circle.rf { fill: none; stroke-width: 5; stroke-dasharray: 163.4; stroke-dashoffset: 163.4; stroke: var(--blue); transition: stroke-dashoffset 0.5s ease; stroke-linecap: round; filter: drop-shadow(0 0 3px var(--blue)); }

/* ‚îÄ‚îÄ GPS ‚îÄ‚îÄ */
.gps-row {
  display: flex; align-items: center; gap: 8px;
  padding: 9px 12px; background: var(--surface); border: 1px solid var(--border2);
  border-radius: 10px; margin-bottom: 12px;
}
.gdot { width: 8px; height: 8px; border-radius: 50%; background: var(--muted); transition: all 0.4s; flex-shrink: 0; }
.gdot.ok { background: var(--green); box-shadow: 0 0 10px var(--green); animation: gpsPulse 2s infinite; }
@keyframes gpsPulse { 0%,100%{box-shadow:0 0 6px var(--green)} 50%{box-shadow:0 0 16px var(--green),0 0 30px rgba(0,255,136,0.3)} }
.glbl { font-size: 9px; letter-spacing: 3px; color: var(--muted2); flex-shrink: 0; font-weight: 700; }
.gmsg { color: var(--muted2); flex: 1; font-size: 11px; }
.gswitch { position: relative; display: inline-block; width: 42px; height: 22px; flex-shrink: 0; }
.gswitch input { opacity: 0; width: 0; height: 0; }
.gslider { position: absolute; cursor: pointer; inset: 0; background: rgba(0,0,0,0.4); border-radius: 22px; transition: 0.3s; border: 1px solid var(--muted); }
.gslider:before { content: ''; position: absolute; width: 16px; height: 16px; left: 2px; top: 2px; background: var(--muted); border-radius: 50%; transition: 0.3s; }
input:checked + .gslider { background: rgba(0,255,136,0.15); border-color: var(--green); }
input:checked + .gslider:before { background: var(--green); transform: translateX(20px); box-shadow: 0 0 8px var(--green); }

.div { height: 1px; background: var(--border2); margin: 0 0 12px; }
.sec-lbl { font-size: 8px; letter-spacing: 4px; color: var(--muted2); margin-bottom: 8px; text-transform: uppercase; font-weight: 700; }

/* ‚îÄ‚îÄ TARIFF ‚îÄ‚îÄ */
.tariff-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; margin-bottom: 12px; }
.tbtn {
  background: var(--surface); border: 1px solid var(--border2);
  border-radius: 10px; padding: 8px 4px; cursor: pointer;
  color: var(--muted2); font-family: 'Rajdhani', sans-serif;
  text-align: center; transition: all 0.2s; -webkit-appearance: none;
}
.tbtn.on { background: rgba(0,212,255,0.08); border-color: rgba(0,212,255,0.5); color: var(--blue); box-shadow: 0 0 10px rgba(0,212,255,0.1); }
.tm { font-family: 'Orbitron', monospace; font-weight: 700; font-size: 12px; margin-bottom: 2px; }
.ts { font-size: 9px; }

/* ‚îÄ‚îÄ EXTRAS ‚îÄ‚îÄ */
.extras { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 14px; }
.ecard { background: var(--surface); border: 1px solid var(--border2); border-radius: 10px; padding: 9px 10px; }
.elbl { font-size: 8px; letter-spacing: 3px; color: var(--muted2); margin-bottom: 7px; text-transform: uppercase; font-weight: 700; }
.erow { display: flex; align-items: center; gap: 6px; }
.eval { flex: 1; text-align: center; font-family: 'Share Tech Mono', monospace; font-size: 20px; color: var(--text); }
.eval.w { color: var(--blue); }
.enote { font-size: 9px; color: var(--blue); margin-top: 4px; }
.abtn { width: 30px; height: 30px; border-radius: 7px; border: 1px solid var(--border2); background: rgba(0,0,0,0.3); color: var(--muted2); cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; -webkit-appearance: none; transition: all 0.15s; font-family: 'Rajdhani', sans-serif; line-height: 1; }
.abtn:active { background: rgba(0,212,255,0.12); border-color: var(--blue); color: var(--blue); }

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.actions { display: flex; flex-direction: column; gap: 8px; margin-top: auto; }
.arow { display: grid; gap: 8px; }
.bbtn { padding: 16px; border-radius: 12px; border: none; cursor: pointer; font-family: 'Orbitron', monospace; font-weight: 700; font-size: 14px; letter-spacing: 4px; text-transform: uppercase; -webkit-appearance: none; transition: all 0.2s; width: 100%; }
.bstart { background: linear-gradient(135deg, #00d4ff, #0077aa); color: #02080f; box-shadow: 0 4px 24px rgba(0,212,255,0.4), 0 1px 0 rgba(255,255,255,0.15) inset; }
.bstart:active { transform: scale(0.98); }
.bstop { background: rgba(255,51,85,0.1); color: var(--red); border: 1px solid rgba(255,51,85,0.4) !important; box-shadow: 0 0 15px rgba(255,51,85,0.1); }
.breset { background: rgba(255,255,255,0.03); color: var(--muted2); border: 1px solid var(--border2) !important; }
.bnew { background: transparent; color: var(--muted2); border: 1px solid var(--border2) !important; font-size: 11px; }

/* ‚îÄ‚îÄ MAP ‚îÄ‚îÄ */
.map-panel { flex: 1; height: 100%; position: relative; background: #05080d; }
#map { width: 100%; height: 100%; }
.leaflet-tile-pane { filter: brightness(0.25) contrast(1.4) saturate(0.3) hue-rotate(200deg); }
.leaflet-container { background: #05080d; }
.leaflet-control-zoom { border: 1px solid rgba(0,212,255,0.2) !important; background: rgba(5,8,13,0.9) !important; }
.leaflet-control-zoom a { background: transparent !important; color: var(--blue) !important; border-color: rgba(0,212,255,0.2) !important; font-size: 16px !important; }
.leaflet-control-attribution { display: none; }

/* ‚îÄ‚îÄ HUD ‚îÄ‚îÄ */
.hud-tl { position: absolute; top: 16px; left: 16px; z-index: 1000; display: flex; flex-direction: column; gap: 8px; }
.hud-tr { position: absolute; top: 16px; right: 16px; z-index: 1000; }
.hud-card { background: rgba(5,8,13,0.88); backdrop-filter: blur(12px); border: 1px solid rgba(0,212,255,0.15); border-radius: 12px; padding: 10px 14px; box-shadow: 0 4px 20px rgba(0,0,0,0.6); }
.hud-title { font-size: 8px; letter-spacing: 4px; color: var(--muted2); text-transform: uppercase; margin-bottom: 6px; font-family: 'Orbitron', monospace; }
.hud-stat { display: flex; justify-content: space-between; align-items: center; gap: 20px; margin-bottom: 3px; }
.hud-stat:last-child { margin-bottom: 0; }
.hud-lbl { font-size: 9px; color: var(--muted2); letter-spacing: 1px; }
.hud-val { font-family: 'Share Tech Mono', monospace; font-size: 13px; color: var(--blue); }
.speed-hud { background: rgba(5,8,13,0.88); backdrop-filter: blur(12px); border: 1px solid rgba(0,212,255,0.2); border-radius: 12px; padding: 12px 18px; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.6); }
.speed-num { font-family: 'Orbitron', monospace; font-size: 42px; font-weight: 900; color: var(--blue); line-height: 1; text-shadow: 0 0 20px rgba(0,212,255,0.5); }
.speed-unit { font-size: 10px; letter-spacing: 3px; color: var(--muted2); margin-top: 2px; }
.heading-hud { background: rgba(5,8,13,0.88); backdrop-filter: blur(12px); border: 1px solid rgba(0,212,255,0.15); border-radius: 12px; padding: 10px 14px; text-align: center; min-width: 80px; }
.heading-dir { font-family: 'Orbitron', monospace; font-size: 20px; font-weight: 700; color: var(--blue); }
.heading-deg { font-size: 10px; color: var(--muted2); letter-spacing: 2px; margin-top: 2px; }
.hired-banner { position: absolute; top: 16px; left: 50%; transform: translateX(-50%); z-index: 1000; display: none; }
.hired-banner.show { display: block; }
.hired-banner-inner { background: rgba(0,255,136,0.1); backdrop-filter: blur(12px); border: 1px solid rgba(0,255,136,0.4); border-radius: 8px; padding: 6px 20px; font-family: 'Orbitron', monospace; font-size: 12px; font-weight: 700; letter-spacing: 4px; color: var(--green); box-shadow: 0 0 20px rgba(0,255,136,0.15); animation: bannerPulse 3s infinite; }
@keyframes bannerPulse { 0%,100%{opacity:1} 50%{opacity:0.7} }
.brightness-bar { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; background: rgba(5,8,13,0.88); backdrop-filter: blur(12px); border: 1px solid rgba(0,212,255,0.15); border-radius: 12px; padding: 10px 16px; display: flex; align-items: center; gap: 10px; white-space: nowrap; }
.brightness-bar span { font-size: 9px; letter-spacing: 3px; color: var(--muted2); font-family: 'Orbitron', monospace; }
.recenter { position: absolute; bottom: 20px; right: 16px; z-index: 1000; width: 46px; height: 46px; border-radius: 12px; background: rgba(5,8,13,0.88); backdrop-filter: blur(12px); border: 1px solid rgba(0,212,255,0.2); color: var(--blue); font-size: 22px; cursor: pointer; display: flex; align-items: center; justify-content: center; -webkit-appearance: none; box-shadow: 0 4px 16px rgba(0,0,0,0.5); transition: all 0.2s; }
.recenter:active { background: rgba(0,212,255,0.1); }
</style>
</head>
<body>

<!-- ‚ïê‚ïê PIN SCREEN ‚ïê‚ïê -->
<div class="pin-screen" id="pinScreen">
  <div class="pin-logo">üöñ</div>
  <div class="pin-title">BLUELINE</div>
  <div class="pin-sub">ENTER PIN TO CONTINUE</div>
  <div class="pin-dots">
    <div class="pin-dot" id="pd0"></div>
    <div class="pin-dot" id="pd1"></div>
    <div class="pin-dot" id="pd2"></div>
    <div class="pin-dot" id="pd3"></div>
  </div>
  <div class="pin-grid">
    <button class="pin-btn" onclick="pinPress('1')">1</button>
    <button class="pin-btn" onclick="pinPress('2')">2</button>
    <button class="pin-btn" onclick="pinPress('3')">3</button>
    <button class="pin-btn" onclick="pinPress('4')">4</button>
    <button class="pin-btn" onclick="pinPress('5')">5</button>
    <button class="pin-btn" onclick="pinPress('6')">6</button>
    <button class="pin-btn" onclick="pinPress('7')">7</button>
    <button class="pin-btn" onclick="pinPress('8')">8</button>
    <button class="pin-btn" onclick="pinPress('9')">9</button>
    <button class="pin-btn empty"></button>
    <button class="pin-btn" onclick="pinPress('0')">0</button>
    <button class="pin-btn del" onclick="pinDel()">‚å´</button>
  </div>
  <div class="pin-error" id="pinErr"></div>
</div>

<!-- ‚ïê‚ïê APP ‚ïê‚ïê -->
<div class="container">

  <!-- METER -->
  <div class="meter">
    <div class="meter-inner">
      <div class="header">
        <div class="brand">
          <div class="brand-logo">üöñ</div>
          <div>
            <div class="brand-name">BLUELINE</div>
            <div class="brand-sub">NORTH YORKSHIRE</div>
          </div>
        </div>
        <div class="status-wrap">
          <div class="status-pill" id="statusBadge">VACANT</div>
          <div class="tariff-indicator" id="tariffInd">TARIFF 1 ¬∑ T1</div>
        </div>
      </div>
      <div class="fare-section">
        <div class="fare-top"><div class="fare-lbl">Total Fare</div></div>
        <div class="fare-row">
          <div class="fare-currency">¬£</div>
          <div class="fare-amount" id="fareAmt">0.00</div>
        </div>
        <div class="fare-breakdown" id="fareBreak"></div>
      </div>
      <div class="stats">
        <div class="stat"><div class="stat-lbl">Elapsed</div><div class="stat-val" id="timeEl">00:00</div></div>
        <div class="stat"><div class="stat-lbl">Distance</div><div class="stat-val" id="distEl">0 yd</div></div>
        <div class="stat"><div class="stat-lbl">Speed</div><div class="stat-val" id="speedEl">0 mph</div></div>
      </div>
      <div class="rings">
        <div class="ring-card">
          <svg class="ring" width="60" height="60"><circle class="rb" cx="30" cy="30" r="26"/><circle class="rf" id="dRing" cx="30" cy="30" r="26"/></svg>
          <div class="ring-info"><div class="rl">Dist Inc</div><div class="rv" id="dIncV">¬£0.20</div><div class="rp" id="dPct">0%</div></div>
        </div>
        <div class="ring-card">
          <svg class="ring" width="60" height="60"><circle class="rb" cx="30" cy="30" r="26"/><circle class="rf" id="wRing" cx="30" cy="30" r="26"/></svg>
          <div class="ring-info"><div class="rl">Wait Inc</div><div class="rv" id="wIncV">¬£0.20</div><div class="rp" id="wPct">0%</div></div>
        </div>
      </div>
      <div class="gps-row">
        <div class="gdot" id="gpsDot"></div>
        <span class="glbl">GPS</span>
        <span class="gmsg" id="gpsMsg">Off ‚Äî time only</span>
        <label class="gswitch"><input type="checkbox" id="gpsToggle" onchange="toggleGps(this.checked)"><span class="gslider"></span></label>
      </div>
      <div class="div"></div>
      <div class="sec-lbl">Tariff</div>
      <div class="tariff-row">
        <button class="tbtn on" data-t="1" onclick="selT(1)"><div class="tm">T1</div><div class="ts">¬£4.00</div><div class="ts">+¬£0.20</div></button>
        <button class="tbtn" data-t="2" onclick="selT(2)"><div class="tm">T2</div><div class="ts">¬£5.40</div><div class="ts">+¬£0.30</div></button>
        <button class="tbtn" data-t="3" onclick="selT(3)"><div class="tm">T3</div><div class="ts">¬£7.20</div><div class="ts">+¬£0.40</div></button>
      </div>
      <div class="extras">
        <div class="ecard">
          <div class="elbl">Passengers</div>
          <div class="erow"><button class="abtn" onclick="adjP(-1)">‚àí</button><div class="eval" id="paxV">1</div><button class="abtn" onclick="adjP(1)">+</button></div>
          <div class="enote" id="paxN" style="display:none">+¬£1.00/head</div>
        </div>
        <div class="ecard">
          <div class="elbl">Call-Out (mi)</div>
          <div class="erow"><button class="abtn" onclick="adjC(-0.5)">‚àí</button><div class="eval" id="coV">0.0</div><button class="abtn" onclick="adjC(0.5)">+</button></div>
          <div class="enote" id="coN" style="display:none"></div>
        </div>
      </div>
      <div class="actions" id="actions">
        <button class="bbtn bstart" onclick="startM()">‚ñ∂ START JOURNEY</button>
      </div>
    </div>
  </div>

  <!-- MAP -->
  <div class="map-panel">
    <div id="map"></div>
    <div class="hud-tl">
      <div class="speed-hud"><div class="speed-num" id="mapSpd">0</div><div class="speed-unit">MPH</div></div>
      <div class="heading-hud"><div class="heading-dir" id="mapDir">‚Äî</div><div class="heading-deg" id="mapDeg"></div></div>
    </div>
    <div class="hud-tr">
      <div class="hud-card">
        <div class="hud-title">Journey</div>
        <div class="hud-stat"><span class="hud-lbl">Fare</span><span class="hud-val" id="mapFare">¬£0.00</span></div>
        <div class="hud-stat"><span class="hud-lbl">Distance</span><span class="hud-val" id="mapDist">0 yd</span></div>
        <div class="hud-stat"><span class="hud-lbl">Time</span><span class="hud-val" id="mapTime">00:00</span></div>
      </div>
    </div>
    <div class="hired-banner" id="hiredBanner"><div class="hired-banner-inner">‚óè HIRED</div></div>
    <div class="brightness-bar">
      <span>MAP</span>
      <span>üåë</span>
      <input type="range" id="brightSlider" min="10" max="80" value="25" oninput="setBright(this.value)" style="width:120px;accent-color:#00d4ff;cursor:pointer;">
      <span>‚òÄÔ∏è</span>
    </div>
    <button class="recenter" onclick="recentre()">‚äï</button>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// ‚îÄ‚îÄ PIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const PIN='1985';
let pinEntry='';
function pinPress(d){if(pinEntry.length>=4)return;pinEntry+=d;updateDots();if(pinEntry.length===4)checkPin();}
function pinDel(){pinEntry=pinEntry.slice(0,-1);document.getElementById('pinErr').textContent='';updateDots();}
function updateDots(err){for(let i=0;i<4;i++){document.getElementById('pd'+i).className='pin-dot'+(i<pinEntry.length?(err?' error':' filled'):'');}}
function checkPin(){
  if(pinEntry===PIN){document.getElementById('pinScreen').classList.add('hidden');}
  else{updateDots(true);document.getElementById('pinErr').textContent='INCORRECT PIN';setTimeout(()=>{pinEntry='';updateDots();document.getElementById('pinErr').textContent='';},1200);}
}

// ‚îÄ‚îÄ CONSTANTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const T={1:{f:4.00,i:0.20,l:'TARIFF 1'},2:{f:5.40,i:0.30,l:'TARIFF 2'},3:{f:7.20,i:0.40,l:'TARIFF 3'}};
const DIM=145.0,FFM=402.34,TIS=35.0,WMP=0.5,CIRC=163.4,GS=3;

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let tk=autoT(),pax=1,co=0,run=false,gOn=false;
let fare=0,dm=0,es=0,smph=0,hdg=null,da=0,wa=0;
let lp=null,wid=null,tt=null,lgu=0,locked=true,flagDropped=false;
function autoT(){return new Date().getHours()>=6?1:2;}

// ‚îÄ‚îÄ MAP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const map=L.map('map',{zoomControl:false,attributionControl:false}).setView([54.0,-1.54],15);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
L.control.zoom({position:'bottomright'}).addTo(map);
map.on('dragstart',()=>locked=false);

const carIcon=L.divIcon({
  className:'',
  html:`<div style="position:relative;width:20px;height:20px">
    <div style="position:absolute;inset:-8px;background:rgba(0,212,255,0.15);border-radius:50%;animation:ripple 2s infinite"></div>
    <div style="position:absolute;inset:0;background:#00d4ff;border:3px solid #fff;border-radius:50%;box-shadow:0 0 16px #00d4ff,0 0 30px rgba(0,212,255,0.5)"></div>
  </div>
  <style>@keyframes ripple{0%{transform:scale(1);opacity:0.6}100%{transform:scale(2.5);opacity:0}}</style>`,
  iconSize:[20,20],iconAnchor:[10,10]
});
let car=L.marker([54.0,-1.54],{icon:carIcon,zIndexOffset:1000}).addTo(map);
let route=L.polyline([],{color:'#00d4ff',weight:4,opacity:0.9}).addTo(map);
let rc=[];

function recentre(){locked=true;if(lp)map.setView([lp.lat,lp.lon],map.getZoom());}
function setBright(v){const tp=document.querySelector('.leaflet-tile-pane');if(tp)tp.style.filter=`brightness(${v/100}) contrast(1.4) saturate(0.3) hue-rotate(200deg)`;}

// ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function hav(a,b,c,d){const R=6371000,p1=a*Math.PI/180,p2=c*Math.PI/180,dp=(c-a)*Math.PI/180,dl=(d-b)*Math.PI/180,x=Math.sin(dp/2)**2+Math.cos(p1)*Math.cos(p2)*Math.sin(dl/2)**2;return R*2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));}
function ft(s){return String(Math.floor(s/60)).padStart(2,'0')+':'+String(s%60).padStart(2,'0');}
function fd(m){const mi=m/1609.34;return mi>=0.1?mi.toFixed(2)+' mi':Math.round(m*1.09361)+' yd';}
function fm(n){return '¬£'+n.toFixed(2);}
function dirs(h){if(h===null)return{d:'‚Äî',deg:''};const a=['N','NE','E','SE','S','SW','W','NW'];return{d:a[Math.round(h/45)%8],deg:Math.round(h)+'¬∞'};}

// ‚îÄ‚îÄ GPS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleGps(on){
  gOn=on;
  if(on){
    if(!navigator.geolocation){gUI(false,'Not available');document.getElementById('gpsToggle').checked=false;gOn=false;return;}
    gUI(false,'Requesting‚Ä¶');
    navigator.geolocation.getCurrentPosition(
      pos=>{gUI(true,'Signal acquired ‚Äî following');const{latitude:la,longitude:lo}=pos.coords;map.setView([la,lo],16);car.setLatLng([la,lo]);sw();},
      ()=>{gUI(false,'Permission denied');document.getElementById('gpsToggle').checked=false;gOn=false;},
      {enableHighAccuracy:true,timeout:15000}
    );
  }else{stopW();smph=0;hdg=null;lp=null;document.getElementById('gpsDot').className='gdot';gUI(false,'Off ‚Äî time only');}
}
function sw(){if(!gOn||!navigator.geolocation)return;if(wid!==null)navigator.geolocation.clearWatch(wid);wid=navigator.geolocation.watchPosition(onP,onE,{enableHighAccuracy:true,maximumAge:500,timeout:15000});}
function stopW(){if(wid!==null){navigator.geolocation.clearWatch(wid);wid=null;}}

function onP(pos){
  gUI(true,'Signal acquired ‚Äî following');lgu=Date.now();
  const{latitude:la,longitude:lo,speed:sp,heading:hd}=pos.coords;
  const mph=sp!=null?sp*2.23694:0;smph=+mph.toFixed(1);hdg=hd;
  car.setLatLng([la,lo]);if(locked)map.setView([la,lo],map.getZoom());
  if(!run){lp={lat:la,lon:lo};render();return;}
  if(lp){
    const d=hav(lp.lat,lp.lon,la,lo);dm+=d;
    // Add initial drop increment when flag fall distance first reached
    if(!flagDropped&&dm>=FFM){flagDropped=true;inc();}
    if(mph>WMP&&dm>FFM){da+=d;while(da>=DIM){da-=DIM;inc();}}
    rc.push([la,lo]);route.setLatLngs(rc);
  }
  lp={lat:la,lon:lo};render();
}
function onE(){gUI(false,'Signal lost');}
function gUI(ok,msg){document.getElementById('gpsDot').className='gdot'+(ok?' ok':'');document.getElementById('gpsMsg').textContent=msg;}

// ‚îÄ‚îÄ METER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function inc(){
  fare=+(fare+T[tk].i).toFixed(2);
  const el=document.getElementById('fareAmt');
  el.classList.remove('flash');void el.offsetWidth;el.classList.add('flash');
  setTimeout(()=>el.classList.remove('flash'),300);
}
function startTick(){
  tt=setInterval(()=>{
    if(!run)return;es++;
    const stale=gOn&&(Date.now()-lgu>GS*1000);
    if(smph<=WMP||stale){wa++;if(wa>=TIS){wa-=TIS;inc();}}
    render();
  },1000);
}
function stopTick(){if(tt){clearInterval(tt);tt=null;}}

function startM(){
  fare=T[tk].f;dm=0;es=0;smph=0;hdg=null;da=0;wa=0;lp=null;lgu=Date.now();flagDropped=false;
  rc=[];route.setLatLngs([]);run=true;
  setSt('HIRED','hired');
  document.getElementById('hiredBanner').classList.add('show');
  if(gOn)sw();startTick();rAct();render();
}
function stopM(){
  run=false;stopTick();
  setSt('COMPLETE','complete');
  document.getElementById('hiredBanner').classList.remove('show');
  rAct();render();
}
function resetM(){
  run=false;stopTick();
  fare=0;dm=0;es=0;smph=0;hdg=null;da=0;wa=0;
  rc=[];route.setLatLngs([]);
  tk=autoT();pax=1;co=0;
  setSt('VACANT','');
  document.getElementById('hiredBanner').classList.remove('show');
  gUI(gOn,gOn?'Signal acquired ‚Äî following':'Off ‚Äî time only');
  rAct();rTar();rExt();render();
}
function setSt(t,cls){const el=document.getElementById('statusBadge');el.textContent=t;el.className='status-pill '+cls;}
function selT(k){if(run)return;tk=k;rTar();render();}
function adjP(d){pax=Math.min(10,Math.max(1,pax+d));rExt();render();}
function adjC(d){co=Math.max(0,+(co+d).toFixed(1));rExt();render();}

function rTar(){
  document.querySelectorAll('.tbtn').forEach(b=>{const k=parseInt(b.dataset.t),on=k===tk;b.className='tbtn'+(on?' on':'');b.disabled=run;b.style.opacity=run?0.45:1;});
  document.getElementById('tariffInd').textContent=T[tk].l+' ¬∑ T'+tk;
}
function rExt(){
  const pv=document.getElementById('paxV');pv.textContent=pax;pv.className='eval'+(pax>=5?' w':'');
  document.getElementById('paxN').style.display=pax>=5?'':'none';
  const cc=co>1?co-1:0,cv=document.getElementById('coV');
  cv.textContent=co.toFixed(1);cv.className='eval'+(co>1?' w':'');
  const cn=document.getElementById('coN');
  if(co>1){cn.textContent='+¬£'+cc.toFixed(2)+' callout';cn.style.display='';}else{cn.style.display='none';}
}
function rAct(){
  const el=document.getElementById('actions');
  if(run){el.innerHTML=`<div class="arow" style="grid-template-columns:1fr 1fr"><button class="bbtn bstop" onclick="stopM()">‚ñ† STOP</button><button class="bbtn breset" onclick="resetM()">‚Ü∫ RESET</button></div>`;}
  else{el.innerHTML=`<button class="bbtn bstart" onclick="startM()">‚ñ∂ START JOURNEY</button>`+(fare>0?`<button class="bbtn bnew" onclick="resetM()" style="margin-top:8px">‚Ü∫ NEW JOURNEY</button>`:'');}
}
function render(){
  const t=T[tk],pc=pax>=5?pax:0,cc=co>1?co-1:0,tot=+(fare+pc+cc).toFixed(2);
  document.getElementById('fareAmt').textContent=tot.toFixed(2);
  const pts=[];if(pc>0||cc>0){pts.push('Meter: '+fm(fare));if(pc>0)pts.push('Pax: '+fm(pc));if(cc>0)pts.push('Callout: '+fm(cc));}
  document.getElementById('fareBreak').textContent=pts.join('  ¬∑  ');
  document.getElementById('timeEl').textContent=ft(es);
  document.getElementById('distEl').textContent=fd(dm);
  document.getElementById('speedEl').textContent=smph+' mph';
  document.getElementById('speedEl').className='stat-val'+(run?' active':'');
  const dp=Math.min(dm>FFM?da/DIM:0,1),wp=Math.min(wa/TIS,1);
  document.getElementById('dRing').style.strokeDashoffset=CIRC*(1-dp);
  document.getElementById('wRing').style.strokeDashoffset=CIRC*(1-wp);
  document.getElementById('dIncV').textContent=fm(t.i);
  document.getElementById('wIncV').textContent=fm(t.i);
  document.getElementById('dPct').textContent=(dp*100).toFixed(0)+'%';
  document.getElementById('wPct').textContent=(wp*100).toFixed(0)+'%';
  document.getElementById('mapSpd').textContent=Math.round(smph);
  const{d,deg}=dirs(hdg);
  document.getElementById('mapDir').textContent=d;
  document.getElementById('mapDeg').textContent=deg;
  document.getElementById('mapFare').textContent=fm(tot);
  document.getElementById('mapDist').textContent=fd(dm);
  document.getElementById('mapTime').textContent=ft(es);
}

rTar();rExt();render();
</script>
</body>
</html>
